\documentclass[12pt,fleqn]{article}\usepackage{../common}
\begin{document}


\begin{minted}[fontsize=\footnotesize]{python}
%load_ext autoreload
%autoreload 2
import pandas as pd, celebpred
clfs, ocols, conf = celebpred.test()
df = pd.read_csv("./data/celeb_astro_mbti.csv",sep=';')
print 'Avg AUC', np.array(list(conf.values())).mean()
\end{minted}

\begin{verbatim}
The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload
Si AUC : 0.928571
Ti AUC : 0.666667
Ne AUC : 0.900000
Fe AUC : 0.250000
Te AUC : 0.555556
Ni AUC : 0.500000
Se AUC : 0.750000
Fi AUC : 0.500000
Avg AUC 0.631349206349
\end{verbatim}

\begin{minted}[fontsize=\footnotesize]{python}
print clfs['Fi']
\end{minted}

\begin{verbatim}
BernoulliRBM(batch_size=10, learning_rate=0.1, n_components=256, n_iter=10,
       random_state=None, verbose=False)
\end{verbatim}

\begin{minted}[fontsize=\footnotesize]{python}
import scipy.sparse as sps
import pandas as pd, mineprep
df_t = pd.DataFrame(index=[0], columns=['mbti', 'name', 'occup', 'bday'])
df_t.loc[0,'mbti'] = 'xxx'
df_t.loc[0,'bday'] = '24/04/1973'
#df_t.loc[0,'bday'] = '5/10/1945'
#df_t.loc[0,'bday'] = '24/04/1973'

df2_t = mineprep.astro_enrich(df_t)

for col in df.columns: 
   if col not in df2_t.columns: df2_t[col] = np.nan
df2_t = df2_t.drop(celebpred.cols,axis=1)
# the order of columns must be exactly the same as 
# the order in the training set
df2_t = df2_t[ocols] 

XX = np.array(df2_t.fillna(0))
print XX.shape

for clf in clfs: 
    #res = clfs[clf].predict_proba(XX)[0] # for Logit
    res = clfs[clf].score_samples(XX) # for RBM
    print clf, res, res*conf[clf]
\end{minted}

\begin{verbatim}
(1, 351)
Ni -4.59937464349 -2.29968732175
Ne -23.6420678802 -21.2778610922
Si -24.2040280269 -22.4751688821
Fe -5.08684908889 -1.27171227222
Ti -37.0735879704 -24.7157253136
Fi -1.28218896377 -0.641094481884
Te -93.024602934 -51.6803349634
Se -1.78112487567 -1.33584365675
\end{verbatim}


\end{document}
