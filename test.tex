\documentclass[12pt,fleqn]{article}\usepackage{../common}
\begin{document}

\begin{minted}[fontsize=\footnotesize]{python}
import pandas as pd
letter_cols = ['Si','Ti','Ne','Fe','Te','Ni','Se','Fi']
junk_cols = ['mbti','name','occup','bday','bday2','NeFi','NeTi','NiTe','NiFe','SiTe','SiFe','SeFi','SeTi']
df = pd.read_csv("./data/celeb_astro_mbti.csv",sep=';')
df = df.drop(junk_cols,axis=1)
df = df.fillna(0)
print df.shape
y = df[letter_cols]
str_cols = ['mbti','name','occup','bday','bday2']
Xs = df.drop(letter_cols, axis=1)
Xs += 1e-7
Xs = np.array(Xs)
print Xs.shape
\end{minted}

\begin{verbatim}
(427, 362)
(427, 354)
\end{verbatim}


\begin{minted}[fontsize=\footnotesize]{python}
from sklearn.cross_validation import train_test_split
s = 0.30
depth = 3
k = 4
x_train, x_test, y_train, y_test = train_test_split(Xs, y, test_size=s, random_state=42)
from sklearn.ensemble import RandomForestRegressor
clf = RandomForestRegressor(max_depth=depth)
clf.fit(x_train,y_train)
res = clf.predict(x_test)
hit_arr = []

for i in range(len(x_test)):
   pred = pd.Series(res[i, :], index=letter_cols).order(ascending=False).head(k).index    
   real = pd.Series(y_test[i, :], index=letter_cols).order(ascending=False).head(k).index    
   hits = len([x for x in real if x in pred]) / float(len(real))
   #print list(pred), list(real), hits
   hit_arr.append(hits)
print 'pred',np.mean(np.array(hit_arr))
\end{minted}

\begin{verbatim}
pred 0.593023255814
\end{verbatim}

\begin{minted}[fontsize=\footnotesize]{python}
import pandas as pd, mineprep
df_t = pd.DataFrame(index=[0], columns=['mbti', 'name', 'occup', 'bday'])
df_t.loc[0,'mbti'] = 'xxx'
df_t.loc[0,'bday'] = '24/04/1973'
df2_t = mineprep.astro_enrich(df_t)
df2_t = df2_t.drop(junk_cols + letter_cols + ['E','I'], axis=1)
print df2_t
res = clf.predict(x_test)
pred = pd.Series(res[i, :], index=letter_cols).order(ascending=False).head(k).index    
print pred
\end{minted}

\begin{verbatim}
   lewi0  lewi1  lewi2  lewi3  lewi4  lewi5  lewi6  lewi7  lewi8  lewi9  \
0    NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN   

   ...    mills5  mills6  mills7  mills8  mills9  M1=30  M2=3  chinese=Ox  \
0  ...       NaN     NaN     NaN     NaN     NaN      1     1           1   

   spiller=Capricorn  diversity  
0                  1         14  

[1 rows x 293 columns]
Index([u'Fi', u'Se', u'Ne', u'Ti'], dtype='object')
\end{verbatim}



















\end{document}
